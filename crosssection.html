<!DOCTYPE html>
<html>
<head>
	<title>CrossSection+</title>
	<link rel="apple-touch-icon" sizes="180x180" href="img/cross-section-favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="img/cross-section-favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="img/cross-section-favicon/favicon-16x16.png">
	<link rel="manifest" href="img/cross-section-favicon/site.webmanifest">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
html {
	font-family: sans-serif;
}
	</style>
	<link rel="stylesheet" href="css/main.css" />
</style>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/osmtogeojson@2.2.12/osmtogeojson.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="js/leaflet-providers.js"></script>
<script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
<script src="js/leaflet.geometryutil.js"></script>
<script src="js/leaflet.almostover.js"></script>
<script src="https://kit.fontawesome.com/a7ec421c16.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
<script>	const scr = document.createElement('script');	scr.setAttribute('src', window.atob('aHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2pzP2tleT1BSXphU3lBc1JHWlRNUlFPR2hiNDNOTmdfRnRiWERZZHFkTEhWcEE='));	scr.setAttribute("async", "");	scr.setAttribute("defer", "");	document.head.appendChild(scr)</script>
<script src="https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js"></script>

<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="js/osmtostreetmix.js"></script>
<script src="js/lineOffset1.js"></script>

<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css" />
<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>

<link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
<script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet-gesture-handling/dist/leaflet-gesture-handling.min.css" type="text/css">
<script src="https://unpkg.com/leaflet-gesture-handling"></script>

<!-- Load Esri Leaflet from CDN -->
<script src="https://unpkg.com/esri-leaflet@^3.0.9/dist/esri-leaflet.js"></script>
<script src="https://unpkg.com/esri-leaflet-vector@4.0.0/dist/esri-leaflet-vector.js"></script>

<script src="js/calcstats.js"></script>
<script src="js/drawLaneMarkings.js"></script>
<script src="js/leaflet.rotatedMarker.js"></script>

<style>
.mb-3 {
  margin-bottom: 0rem !important;
}</style>
</head>
<body onload="loadFeature();">
	<div id="container" style="display:flex;flex-flow: row wrap;">
	<div id="controls" style="float:left;width:30%;height:100%">

		<form>
			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">oneway</label>
			  <select id="oneway" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="yes">yes</option>
				  <option value="" selected>no</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">maxspeed</label>
			  <select id="maxspeed" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="5">5</option>
				  <option value="10">10</option>
				  <option value="15">15</option>
				  <option value="20">20</option>
				  <option value="25">25</option>
				  <option value="30">30</option>
				  <option value="35">35</option>
				  <option value="40">40</option>
				  <option value="45">45</option>
				  <option value="50">50</option>
				  <option value="55">55</option>
				  <option value="60">60</option>
				  <option value="65">65</option>
				  <option value="70">70</option>
				  <option value="75">75</option>
				</select>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="mphCheck" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">mph</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">lanes</label>
			  <select id="lanes" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="1">1</option>
				  <option value="2" selected>2</option>
				  <option value="3">3</option>
				  <option value="4">4</option>
				  <option value="5">5</option>
				  <option value="6">6</option>
				  <option value="7">7</option>
				  <option value="8">8</option>
				  <option value="9">9</option>
				  <option value="10">10</option>
				  <option value="11">11</option>
				  <option value="12">12</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">lanes:forward</label>
			  <select id="lanes:forward" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>0</option>
				  <option value="1">1</option>
				  <option value="2">2</option>
				  <option value="3">3</option>
				  <option value="4">4</option>
				  <option value="5">5</option>
				  <option value="6">6</option>
				  <option value="7">7</option>
				  <option value="8">8</option>
				  <option value="9">9</option>
				  <option value="10">10</option>
				  <option value="11">11</option>
				  <option value="12">12</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">lanes:backward</label>
			  <select id="lanes:backward" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>0</option>
				  <option value="1">1</option>
				  <option value="2">2</option>
				  <option value="3">3</option>
				  <option value="4">4</option>
				  <option value="5">5</option>
				  <option value="6">6</option>
				  <option value="7">7</option>
				  <option value="8">8</option>
				  <option value="9">9</option>
				  <option value="10">10</option>
				  <option value="11">11</option>
				  <option value="12">12</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">lanes:width</label>
			  <input id="lanes:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="11' default"></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftLaneCheck" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>
			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">lanes:forward:width</label>
			  <input id="lanes:forward:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="11' default"></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftLaneCheckFor" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>
			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">lanes:backward:width</label>
			  <input id="lanes:backward:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="11' default"></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftLaneCheckBack" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>
			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">cycleway:lane:width</label>
			  <input id="cycleway:lane:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="6' default"></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftBikeLaneCheck" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<!-- <div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" id="basic-addon1">cycleway:both</span>
			  <select class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="" selected></option>
				  <option value="lane">Bike lane</option>
				  <option value="shared_lane">Mixed lane (sharrow)</option>
				  <option value="separated">Separated (not drawn with lanes)</option>
				  <option value="track">Cycle track (drawn with lanes)</option>
				</select>
			</div> -->

			<div class="input-group mb-3">
					  <label class="col-sm-7 col-form-label" style="">cycleway</label>
					  <select id="cycleway" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
						  <option value="" selected>None</option>
						  <option value="lane">Bike lane</option>
						  <option value="shared_lane">Mixed lane (sharrow)</option>
						  <option value="track">Cycle track (vertical barrier)</option>
						  <option value="share_busway">Mixed bus lane (sharrow)</option>
						  <option value="separate">Separated (not drawn with lanes)</option>
						</select>
					</div>



		<div class="input-group mb-3">
			<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:separation:right</label>
			<select id="cycleway:right:separation:right" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				<option value="" selected>None</option>
				<option value="barred_area">Painted buffer</option>
				<option value="flex_post">Flex post</option>
				<option value="jersey_barrier">Concrete barrier</option>
				<option value="bollard">Bollard</option>
				<option value="bump">Dome bumps</option>
				<option value="planter">Planter</option>
				<option value="kerb">Kerb/curb</option>
				<option value="cone">Cones</option>
			</select>
		</div>

	<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right</label>
			  <select id="cycleway:right" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="" selected>None</option>
				  <option value="lane">Bike lane</option>
				  <option value="shared_lane">Mixed lane (sharrow)</option>
				  <option value="track">Cycle track (vertical barrier)</option>
				  <option value="share_busway">Mixed bus lane (sharrow)</option>
				  <option value="separate">Separated (not drawn with lanes)</option>
				</select>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:separation:left</label>
				<select id="cycleway:right:separation:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>None</option>
					<option value="barred_area">Painted buffer</option>
					<option value="flex_post">Flex post</option>
					<option value="jersey_barrier">Concrete barrier</option>
					<option value="bollard">Bollard</option>
					<option value="bump">Dome bumps</option>
					<option value="planter">Planter</option>
					<option value="kerb">Kerb/curb</option>
					<option value="cone">Cones</option>
				</select>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:traffic_mode:left</label>
				<select id="cycleway:right:traffic_mode:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>None</option>
					<option value="parking">Parking-protected cycleway</option>
				</select>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:separation:right</label>
				<select id="cycleway:left:separation:right" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>None</option>
					<option value="barred_area">Painted buffer</option>
					<option value="flex_post">Flex post</option>
					<option value="jersey_barrier">Concrete barrier</option>
					<option value="bollard">Bollard</option>
					<option value="bump">Dome bumps</option>
					<option value="planter">Planter</option>
					<option value="kerb">Kerb/curb</option>
					<option value="cone">Cones</option>
				</select>
			</div>

		<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left</label>
			  <select id ="cycleway:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="" selected>None</option>
				  <option value="lane">Bike lane</option>
				  <option value="shared_lane">Mixed lane (sharrow)</option>
				  <option value="track">Cycle track (vertical barrier)</option>
				  <option value="share_busway">Mixed bus lane (sharrow)</option>
				  <option value="separate">Separated (not drawn with lanes)</option>
				</select>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:separation:left</label>
				<select id="cycleway:left:separation:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>None</option>
					<option value="barred_area">Painted buffer</option>
					<option value="flex_post">Flex post</option>
					<option value="jersey_barrier">Concrete barrier</option>
					<option value="bollard">Bollard</option>
					<option value="bump">Dome bumps</option>
					<option value="planter">Planter</option>
					<option value="kerb">Kerb/curb</option>
					<option value="cone">Cones</option>
				</select>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:traffic_mode:left</label>
				<select id="cycleway:left:traffic_mode:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>None</option>
					<option value="parking">Parking-protected cycleway</option>
				</select>
			</div>

		<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">parking:right</label>
			  <select id="parking:right" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="" selected></option>
				  <option value="lane">Lane (shared travel lane)</option>
				  <option value="street_side">Street-side</option>
				  <option value="no">No parking</option>
				</select>
			</div>

		<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">parking:right:orientation</label>
			  <select id="parking:right:orientation" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="parallel">Parallel</option>
				  <option value="perpendicular">Perpendicular</option>
				  <option value="diagonal">Diagonal</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">parking:left</label>
			  <select id="parking:left" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
				  <option value="" selected></option>
				  <option value="lane">Lane (shared travel lane)</option>
				  <option value="street_side">Street-side</option>
				  <option value="no">No parking</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">parking:left:orientation</label>
			  <select id="parking:left:orientation" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="parallel">Parallel</option>
				  <option value="perpendicular">Perpendicular</option>
				  <option value="diagonal">Diagonal</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">parking:both:fee</label>
			  <select id="parking:both:fee" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="no">Free parking</option>
					<option value="yes">Paid parking</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">parking:both:width</label>
			  <input id="parking:both:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="8' default" value=""></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftParkingLaneRightWidthCheck" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">motor_vehicle</label>
			  <select id="motor_vehicle" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>Allowed</option>
					<option value="no">Prohibited</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">bicycle</label>
			  <select id="bicycle" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="yes">Allowed</option>
					<option value="no">Prohibited</option>
					<option value="designated">Designated</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">bus</label>
			  <select id="bus" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="yes">Allowed</option>
					<option value="no">Prohibited</option>
					<option value="designated">Designated</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">bus:lanes:forward</label>
			  <select id="bus:lanes:forward" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="designated">designated</option>
					<option value="yes|designated">yes|designated</option>
					<option value="yes|yes|designated">yes|yes|designated</option>
					<option value="yes|yes|yes|designated">yes|yes|yes|designated</option>
					<option value="designated|yes">designated|yes</option>
					<option value="designated|yes|yes">designated|yes|yes</option>
					<option value="designated|yes|yes|yes">designated|yes|yes|yes</option>
					<!-- <option value="yes|designated|yes">yes|designated|yes</option>
					<option value="yes|yes|designated|yes">yes|yes|designated|yes</option> -->
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">bus:lanes:backward</label>
			  <select id="bus:lanes:backward" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="designated">designated</option>
					<option value="yes|designated">yes|designated</option>
					<option value="yes|yes|designated">yes|yes|designated</option>
					<option value="yes|yes|yes|designated">yes|yes|yes|designated</option>
					<!-- <option value="yes|designated|yes">yes|designated|yes</option>
					<option value="yes|yes|designated|yes">yes|yes|designated|yes</option> -->
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">turn:lanes:forward</label>
			  <input id="turn:lanes:forward" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder=""></input>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:lanes:forward</label>
				<input id="cycleway:lanes:forward" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder=""></input>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">turn:lanes:backward</label>
			  <input id="turn:lanes:backward" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder=""></input>
			</div>

			<div class="input-group mb-3">
				<label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:lanes:backward</label>
				<input id="cycleway:lanes:backward" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder=""></input>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:separation:left:width</label>
			  <input id="cycleway:right:separation:left:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="2' default" value=""></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftcycleway:right:separation:left:width" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:separation:right:width</label>
			  <input id="cycleway:right:separation:right:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="2' default" value=""></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftcycleway:right:separation:right:width" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:separation:left:width</label>
			  <input id="cycleway:left:separation:left:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="2' default" value=""></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftcycleway:left:separation:left:width" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:separation:right:width</label>
			  <input id="cycleway:left:separation:right:width" type="text" class="form-control" aria-label="Default select example" aria-describedby="basic-addon1" placeholder="2' default" value=""></input>
				<div class="input-group-text">
			    <input class="form-check-input mt-0" id="ftcycleway:left:separation:right:width" type="checkbox" value="" aria-label="Checkbox for following text input" checked><span style="padding-left:0.5rem">ft</span>
			  </div>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label">oneway:bicycle</label>
			  <select id="oneway:bicycle" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected></option>
					<option value="yes">yes</option>
				  <option value="no">no</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: red;">cycleway:right:oneway</label>
			  <select id="cycleway:right:oneway" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>yes</option>
				  <option value="no">no</option>
				</select>
			</div>

			<div class="input-group mb-3">
			  <label class="col-sm-7 col-form-label" style="text-decoration: underline;text-decoration-color: blue;">cycleway:left:oneway</label>
			  <select id="cycleway:left:oneway" class="form-select form-select-sm" aria-label="Default select example" aria-describedby="basic-addon1">
					<option value="" selected>yes</option>
				  <option value="no">no</option>
				</select>
			</div>




			<input id="name" type="text" class="form-control invisible" aria-label="Default select example" aria-describedby="basic-addon1" value=""></input>
			<input id="ref" type="text" class="form-control invisible" aria-label="Default select example" aria-describedby="basic-addon1" value=""></input>
			<input id="width:carriageway" type="text" class="form-control invisible" aria-label="Default select example" aria-describedby="basic-addon1" value=""></input>
			<input id="highway" type="text" class="form-control invisible" aria-label="Default select example" aria-describedby="basic-addon1" value=""></input>
		</form>
		<div id="code" style="float:left;padding:0px;width:100%"></div>
		<button  id="dlJson" type="button" class="btn btn-primary">Copy OSM tags</button>
		<button id="openOSMedit" type="button" class="btn btn-primary">Open OSM editor</button>
		<button id="openJOSMedit" type="button" class="btn btn-primary">Open JOSM editor</button>
	</div>

		<!-- <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" style="float:right;">View map</button> -->
		<div style="float:right;width:70%;height:100%">
	<div id="content" style="float:right;width:100%;"></div>
	<div id="map" style="float:right;width:100%;height:400px">Loading map geometry...</div>
	<span style="border-top:2px solid red; border-bottom:2px solid blue;padding:0px;margin:5px;float:left"><input type="number" id="centerlineOffset" name="centerlineOffset" step="0.5" value="0"></span>
	<br><button id="newTileLayer" type="button" class="btn btn-primary">Switch tile layer</button>
	<div id="stats">Stats</div>

</div>


<div class="toast-container position-fixed bottom-0 start-0 p-3">
	<div id="liveToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      Tags sent to JOSM.
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>

</div>

</div>
<!--
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel" style="width:80%">
  <div class="offcanvas-header">
    <h5 id="offcanvasRightLabel">Aerial Lane Viewer</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">


  </div>
</div> -->
	<script>
var feature;
var streetsAsGeojson;
var wayLineString;
var multiplier = 1.6;
var streetLayer;

var map = L.map('map', {
	maxZoom: 21,
	zoomSnap: 1,
	almostOnMouseMove: false,
    gestureHandling: true
}).setView([41.48850773250226, -81.70947558879621], 2);

// map.pm.addControls({
//   position: 'topleft'
// });

L.control.polylineMeasure({
  'unit': 'landmiles',
  'showClearControl': true
}).addTo(map);

var hybridMutant = L.gridLayer
  .googleMutant({
    maxZoom: 22,
    type: "hybrid",
    maxNativeZoom: 22
  })
  .addTo(map);

// L.esri.tiledMapLayer({
// 		url: 'https://gis.cuyahogacounty.us/server/rest/services/IMAGERY/2021_Fall_Aerial/MapServer/',
// 		zoomOffset: -10,
// 		maxZoom: 21,
// })
// .addTo(map);

$('#newTileLayer').on('click', function(e) {
  e.preventDefault();
	map.removeLayer(hybridMutant)
	L.esri.tiledMapLayer({
			url: 'https://gis.cuyahogacounty.us/server/rest/services/IMAGERY/2022_Fall_Aerial/MapServer/',
			zoomOffset: -10,
			maxZoom: 21,
	})
	.addTo(map);
});

$('#openOSMedit').on('click', function(e) {
  window.open("https://www.openstreetmap.org/edit?way="+findGetParameter('id'), "_blank");
});

$('#openJOSMedit').on('click', function(e) {
	bounds = streetLayer.getBounds()
	topC = bounds['_northEast']['lat']
	bottom = bounds['_southWest']['lat']
	left = bounds['_southWest']['lng']
	right = bounds['_northEast']['lng']
	console.log(topC, bottom, left, right)
	var originalArray = $('#code').text().trim().split('\n')
	var itemsToBeRemoved = ['source:', 'tiger:', 'old_ref:', 'hgv:'];
	itemsToBeRemoved.forEach(function(rgx){

    // convert each element of itemsToBeRemove to regular expression
    var re = new RegExp(rgx);

    // filter the array by removing the elements that match the regex
    // test() method checks if the string matches the regex
    originalArray = originalArray.filter( word => !re.test(word));


  });
	originalArray = originalArray.map(item => item.replaceAll('|','%7C'));
  // var cleanArray = originalArray.filter(element => !itemsToBeRemoved.some(item => element.includes(item)));
	url = 'http://localhost:8111/load_and_zoom?addtags='+encodeURI(originalArray.join('|'))+'&select=way'+findGetParameter('id')+',&left='+left+'&right='+right+'&top='+topC+'&bottom='+bottom
	// window.open(url);

	$.get( url, function( data ) {
	  // $( ".result" ).html( data );
	  console.log(data)
		const toastLiveExample = document.getElementById('liveToast')
		const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
		toastBootstrap.show()

	})  .fail(function() {
    alert( "Please open the JOSM app. Remote control settings must be enabled." );
  });
});

// encodeURI



function loadFeature() {

// 	loadCrossSection({'properties': {'tags': {
//   "oneway": "no",
//   "maxspeed": "25 mph",
//   "lanes": 5,
//   "cycleway:right": "lane",
//   "cycleway:left": "lane"
// }}});


	getWayData(id)
}

var form = $('form');
var group = $('.input-group select');

var id = 55553302;
var id = findGetParameter('id')
var lanesLayer = L.featureGroup().addTo(map);
var laneMarkings = L.layerGroup();

var feature;

map.on('zoomend', function() {
  	map.removeLayer(laneMarkings);
    laneMarkings.clearLayers();
    if (map.getZoom() >= 19) {
      streetsAsGeojson['features'].forEach((element) => drawLaneMarkingsFromFeature(element));
      map.addLayer(laneMarkings);
    }
});

$('form').on('change', function(e) {
  e.preventDefault();
	matchElements();
	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
	// streetsAsGeojson['features'].forEach((element) => drawLaneMarkingsFromFeature(element));

	streetStats = {
	  'total_shared_lane': 0,
	  'total_bike_lane': 0,
	  'total_separated_cycleway': 0,
	  'total_cycleway_highway': 0,
	  'total_residential_etc': 0,
	  'shared_25': 0,
	  'shared_35': 0,
	  'primary': 0,
	  'secondary': 0,
	  'tertiary': 0,
	  'primary_no_bikeinfra': 0,
	  'secondary_no_bikeinfra': 0,
	  'tertiary_no_bikeinfra': 0,
	  'primary_cyclelane': 0,
	  'secondary_cyclelane': 0,
	  'tertiary_cyclelane': 0,
	  'residential_cyclelane': 0,
	  'primary_sharedlane': 0,
	  'secondary_sharedlane': 0,
	  'tertiary_sharedlane': 0,
	  'residential_sharedlane': 0
	}
// console.log(streetsAsGeojson)
// console.log(feature)
	streetsAsGeojson['features'][0]['properties'] = feature['properties']
	clearStreetStats()
	streetStats = (calcStreetStats(streetsAsGeojson['features'][0]))
	updateStats(streetStats)
	console.log(streetStats)
});

function matchElements() {
	var elements = document.getElementsByTagName("select")
	for (var i = 0; i < elements.length; i++) {
			if(elements[i].value == "") {
				delete feature.properties.tags[elements[i].id]
			} else {
				if (isNaN(elements[i].value) == true) {
					feature.properties.tags[elements[i].id] = elements[i].value
				} else {
				if (elements[i].id == 'maxspeed' && $('#mphCheck').is(':checked')==true) {
					feature.properties.tags[elements[i].id] = Number(elements[i].value) + " mph"
				} else {
					feature.properties.tags[elements[i].id] = Number(elements[i].value)
				}
			}
		}
	}
	if (document.getElementById("lanes:width").value != "") {
		if (document.getElementById("ftLaneCheck").checked && (document.getElementById("lanes:width").value.includes("'")) == false) {
			feature.properties.tags['lanes:width'] = document.getElementById("lanes:width").value + "'"
		} else {
			feature.properties.tags['lanes:width'] = Number(document.getElementById("lanes:width").value)
		}

	}
	if (document.getElementById("lanes:forward:width").value != "") {
		tempLanesForwardWidthArray = []
		if (document.getElementById("ftLaneCheckFor").checked && (document.getElementById("lanes:forward:width").value.includes("'")) == false) {
			if (document.getElementById("lanes:forward:width").value.includes("|")) {
				// feature.properties.tags['lanes:forward:width'] = document.getElementById("lanes:forward:width").value.replaceAll("|","'|") + "'"
				for (i=0; i<document.getElementById("lanes:forward:width").value.split("|").length; i++) {
					if (document.getElementById("lanes:forward:width").value.split("|")[i] != '') {
						tempLanesForwardWidthArray.push(document.getElementById("lanes:forward:width").value.split("|")[i] + "'")
					} else {
						tempLanesForwardWidthArray.push('')
					}
				}
				feature.properties.tags['lanes:forward:width'] = tempLanesForwardWidthArray.join("|")
			} else {
				feature.properties.tags['lanes:forward:width'] = document.getElementById("lanes:forward:width").value.replaceAll("'","") + "'"
			}
		} else {
			if (document.getElementById("lanes:forward:width").value.includes("|")) {
				// feature.properties.tags['lanes:forward:width'] = document.getElementById("lanes:forward:width").value.replaceAll("'","")
				for (i=0; i<document.getElementById("lanes:forward:width").value.split("|").length; i++) {
					if (document.getElementById("lanes:forward:width").value.split("|")[i] != '') {
						tempLanesForwardWidthArray.push(document.getElementById("lanes:forward:width").value.split("|")[i])
					} else {
						tempLanesForwardWidthArray.push('')
					}
				}
				feature.properties.tags['lanes:forward:width'] = tempLanesForwardWidthArray.join("|")
			} else {
				feature.properties.tags['lanes:forward:width'] = Number(document.getElementById("lanes:forward:width").value)
			}
		}
	}

	if (document.getElementById("lanes:backward:width").value != "") {
		tempLanesBackwardWidthArray = []
		if (document.getElementById("ftLaneCheckFor").checked && (document.getElementById("lanes:backward:width").value.includes("'")) == false) {
			if (document.getElementById("lanes:backward:width").value.includes("|")) {
				for (i=0; i<document.getElementById("lanes:backward:width").value.split("|").length; i++) {
					if (document.getElementById("lanes:backward:width").value.split("|")[i] != '') {
						tempLanesBackwardWidthArray.push(document.getElementById("lanes:backward:width").value.split("|")[i] + "'")
					} else {
						tempLanesBackwardWidthArray.push('')
					}
				}
				feature.properties.tags['lanes:backward:width'] = tempLanesBackwardWidthArray.join("|")
			} else {
				feature.properties.tags['lanes:backward:width'] = document.getElementById("lanes:backward:width").value.replaceAll("'","") + "'"
			}
		} else {
			if (document.getElementById("lanes:backward:width").value.includes("|")) {
				for (i=0; i<document.getElementById("lanes:backward:width").value.split("|").length; i++) {
					if (document.getElementById("lanes:backward:width").value.split("|")[i] != '') {
						tempLanesBackwardWidthArray.push(document.getElementById("lanes:backward:width").value.split("|")[i])
					} else {
						tempLanesBackwardWidthArray.push('')
					}
				}
				feature.properties.tags['lanes:backward:width'] = tempLanesBackwardWidthArray.join("|")
			} else {
				feature.properties.tags['lanes:backward:width'] = Number(document.getElementById("lanes:backward:width").value)
			}
		}
	}

	if (document.getElementById("cycleway:lane:width").value != "") {
		if (document.getElementById("ftBikeLaneCheck").checked && (document.getElementById("cycleway:lane:width").value.includes("'")) == false) {
			feature.properties.tags['cycleway:lane:width'] = document.getElementById("cycleway:lane:width").value + "'"
		} else {
			feature.properties.tags['cycleway:lane:width'] = Number(document.getElementById("cycleway:lane:width").value.replace("'",''))
		}

	}

	if (document.getElementById("parking:both:width").value != "") {
		if (document.getElementById("ftParkingLaneRightWidthCheck").checked && (document.getElementById("parking:both:width").value.includes("'")) == false) {
			feature.properties.tags['parking:both:width'] = document.getElementById("parking:both:width").value + "'"
		} else {
			feature.properties.tags['parking:both:width'] = Number(document.getElementById("parking:both:width").value.replace("'",''))
		}
	}

	if (document.getElementById("cycleway:right:separation:left:width").value != "") {
		if (document.getElementById("ftcycleway:right:separation:left:width").checked && (document.getElementById("cycleway:right:separation:left:width").value.includes("'")) == false) {
			feature.properties.tags['cycleway:right:separation:left:width'] = document.getElementById("cycleway:right:separation:left:width").value + "'"
		} else {
			feature.properties.tags['cycleway:right:separation:left:width'] = Number(document.getElementById("cycleway:right:separation:left:width").value.replace("'",''))
		}
	}

	if (document.getElementById("cycleway:right:separation:right:width").value != "") {
		if (document.getElementById("ftcycleway:right:separation:right:width").checked && (document.getElementById("cycleway:right:separation:right:width").value.includes("'")) == false) {
			feature.properties.tags['cycleway:right:separation:right:width'] = document.getElementById("cycleway:right:separation:right:width").value + "'"
		} else {
			feature.properties.tags['cycleway:right:separation:right:width'] = Number(document.getElementById("cycleway:right:separation:right:width").value.replace("'",''))
		}
	}

	if (document.getElementById("cycleway:left:separation:left:width").value != "") {
		if (document.getElementById("ftcycleway:left:separation:left:width").checked && (document.getElementById("cycleway:left:separation:left:width").value.includes("'")) == false) {
			feature.properties.tags['cycleway:left:separation:left:width'] = document.getElementById("cycleway:left:separation:left:width").value + "'"
		} else {
			feature.properties.tags['cycleway:left:separation:left:width'] = Number(document.getElementById("cycleway:left:separation:left:width").value.replace("'",''))
		}
	}

	if (document.getElementById("cycleway:left:separation:right:width").value != "") {
		if (document.getElementById("ftcycleway:left:separation:right:width").checked && (document.getElementById("cycleway:left:separation:right:width").value.includes("'")) == false) {
			feature.properties.tags['cycleway:left:separation:right:width'] = document.getElementById("cycleway:left:separation:right:width").value + "'"
		} else {
			feature.properties.tags['cycleway:left:separation:right:width'] = Number(document.getElementById("cycleway:left:separation:right:width").value.replace("'",''))
		}
	}
}



$('#centerlineOffset').on('change', function(e) {
	e.preventDefault();
	matchElements();
	drawLanes(streetsAsGeojson)
});


$('#dlJson').on('click', function(e) {
  e.preventDefault();
	copyTextFunc($('#code').text())
});


document.getElementById("lanes:width").addEventListener("keyup", function(){
	if (document.getElementById("lanes:width").value!="") {
		feature.properties.tags['lanes:width'] = document.getElementById("lanes:width").value
		if (document.getElementById("ftLaneCheck").checked) {
			feature.properties.tags['lanes:width'] += "'"
		}
	} else {
		delete feature.properties.tags['lanes:width']
	}

	if ((document.getElementById("lanes:width").value>5 && document.getElementById("ftLaneCheck").checked)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	} else if ((document.getElementById("ftLaneCheck").checked==false)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	}
	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("lanes:forward:width").addEventListener("keyup", function(){
	if (document.getElementById("lanes:forward:width").value!="") {
		tempLanesForwardWidthArray = []
		feature.properties.tags['lanes:forward:width'] = document.getElementById("lanes:forward:width").value
		if (document.getElementById("ftLaneCheckFor").checked) {
			for (i=0; i<feature.properties.tags['lanes:forward:width'].split("|").length; i++) {
				if (feature.properties.tags['lanes:forward:width'].split("|")[i] != '') {
					tempLanesForwardWidthArray.push(feature.properties.tags['lanes:forward:width'].split("|")[i] + "'")
				} else {
					tempLanesForwardWidthArray.push('')
				}
			}
			feature.properties.tags['lanes:forward:width'] = tempLanesForwardWidthArray.join('|')
		}
	} else {
		delete feature.properties.tags['lanes:forward:width']
	}

	if ((document.getElementById("lanes:forward:width").value>5 && document.getElementById("ftLaneCheckFor").checked)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	} else if ((document.getElementById("ftLaneCheckFor").checked==false)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	}
	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("lanes:backward:width").addEventListener("keyup", function(){
	if (document.getElementById("lanes:backward:width").value!="") {
		tempLanesBackwardWidthArray = []
		feature.properties.tags['lanes:backward:width'] = document.getElementById("lanes:backward:width").value
		if (document.getElementById("ftLaneCheckBack").checked) {
			for (i=0; i<feature.properties.tags['lanes:backward:width'].split("|").length; i++) {
				if (feature.properties.tags['lanes:backward:width'].split("|")[i] != '') {
					tempLanesBackwardWidthArray.push(feature.properties.tags['lanes:backward:width'].split("|")[i] + "'")
				} else {
					tempLanesBackwardWidthArray.push('')
				}
			}
			feature.properties.tags['lanes:backward:width'] = tempLanesBackwardWidthArray.join('|')
		}
	} else {
		delete feature.properties.tags['lanes:backward:width']
	}

	if ((document.getElementById("lanes:backward:width").value>5 && document.getElementById("ftLaneCheckBack").checked)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	} else if ((document.getElementById("ftLaneCheckBack").checked==false)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	}
	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:lane:width").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:lane:width").value!="") {
		feature.properties.tags['cycleway:lane:width'] = document.getElementById("cycleway:lane:width").value
		if (document.getElementById("ftBikeLaneCheck").checked) {
			feature.properties.tags['cycleway:lane:width'] += "'"
		}
	} else {
		delete feature.properties.tags['cycleway:lane:width']
	}

	if ((document.getElementById("cycleway:lane:width").value>1 && document.getElementById("ftBikeLaneCheck").checked)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	} else if ((document.getElementById("ftBikeLaneCheck").checked==false)) {
		loadCrossSection(feature)
		drawLanes(streetsAsGeojson)
	}
	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("parking:both:width").addEventListener("keyup", function(){
	if (document.getElementById("parking:both:width").value!="") {
		feature.properties.tags['parking:both:width'] = document.getElementById("parking:both:width").value
		if (document.getElementById("ftParkingLaneRightWidthCheck").checked) {
			feature.properties.tags['parking:both:width'] += "'"
		}
	} else {
		delete feature.properties.tags['parking:both:width']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:right:separation:left:width").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:right:separation:left:width").value!="") {
		feature.properties.tags['cycleway:right:separation:left:width'] = document.getElementById("cycleway:right:separation:left:width").value
		if (document.getElementById("ftcycleway:right:separation:left:width").checked) {
			feature.properties.tags['cycleway:right:separation:left:width'] += "'"
		}
	} else {
		delete feature.properties.tags['cycleway:right:separation:left:width']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:right:separation:right:width").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:right:separation:right:width").value!="") {
		feature.properties.tags['cycleway:right:separation:right:width'] = document.getElementById("cycleway:right:separation:right:width").value
		if (document.getElementById("ftcycleway:right:separation:right:width").checked) {
			feature.properties.tags['cycleway:right:separation:right:width'] += "'"
		}
	} else {
		delete feature.properties.tags['cycleway:right:separation:right:width']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:left:separation:left:width").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:left:separation:left:width").value!="") {
		feature.properties.tags['cycleway:left:separation:left:width'] = document.getElementById("cycleway:left:separation:left:width").value
		if (document.getElementById("ftcycleway:left:separation:left:width").checked) {
			feature.properties.tags['cycleway:left:separation:left:width'] += "'"
		}
	} else {
		delete feature.properties.tags['cycleway:left:separation:left:width']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:left:separation:right:width").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:left:separation:right:width").value!="") {
		feature.properties.tags['cycleway:left:separation:right:width'] = document.getElementById("cycleway:left:separation:right:width").value
		if (document.getElementById("ftcycleway:left:separation:right:width").checked) {
			feature.properties.tags['cycleway:left:separation:right:width'] += "'"
		}
	} else {
		delete feature.properties.tags['cycleway:left:separation:right:width']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);


document.getElementById("cycleway:lanes:forward").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:lanes:forward").value!="") {
		feature.properties.tags['cycleway:lanes:forward'] = document.getElementById("cycleway:lanes:forward").value
	} else {
		delete feature.properties.tags['cycleway:lanes:forward']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("cycleway:lanes:backward").addEventListener("keyup", function(){
	if (document.getElementById("cycleway:lanes:backward").value!="") {
		feature.properties.tags['cycleway:lanes:backward'] = document.getElementById("cycleway:lanes:backward").value
	} else {
		delete feature.properties.tags['cycleway:lanes:backward']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("turn:lanes:forward").addEventListener("keyup", function(){
	if (document.getElementById("turn:lanes:forward").value!="") {
		feature.properties.tags['turn:lanes:forward'] = document.getElementById("turn:lanes:forward").value
	} else {
		delete feature.properties.tags['turn:lanes:forward']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);

document.getElementById("turn:lanes:backward").addEventListener("keyup", function(){
	if (document.getElementById("turn:lanes:backward").value!="") {
		feature.properties.tags['turn:lanes:backward'] = document.getElementById("turn:lanes:backward").value
	} else {
		delete feature.properties.tags['turn:lanes:backward']
	}

	loadCrossSection(feature)
	drawLanes(streetsAsGeojson)
}, true);


function loadCrossSection(feature) {


	if (feature == null) {
		feature = {'properties': {'tags': {}}}

		var elements = document.getElementsByTagName("select")
		for (var i = 0; i < elements.length; i++) {
		    if(elements[i].value == "") {
		    } else {
					if (isNaN(elements[i].value) == true) {
				feature.properties.tags[elements[i].id] = elements[i].value
			} else {
				if (elements[i].id == 'maxspeed' && $('#mphCheck').is(':checked')==true) {
					feature.properties.tags[elements[i].id] = Number(elements[i].value) + " mph"
				} else {
					feature.properties.tags[elements[i].id] = Number(elements[i].value)
				}
			}
			}
		}
		if (document.getElementById("lanes:width").value != "") {
			if (document.getElementById("ftLaneCheck").checked) {
				feature.properties.tags['lanes:width'] = document.getElementById("lanes:width").value + "'"
			} else {
				feature.properties.tags['lanes:width'] = Number(document.getElementById("lanes:width").value)
			}

		}
		if (document.getElementById("lanes:forward:width").value != "") {
			if (document.getElementById("ftLaneCheckFor").checked) {
				feature.properties.tags['lanes:forward:width'] = document.getElementById("lanes:forward:width").value.replace("|","'|") + "'"
			} else {
				feature.properties.tags['lanes:forward:width'] = Number(document.getElementById("lanes:forward:width").value)
			}

		}
		if (document.getElementById("lanes:backward:width").value != "") {
			if (document.getElementById("ftLaneCheckBack").checked) {
				feature.properties.tags['lanes:backward:width'] = document.getElementById("lanes:backward:width").value.replace("|","'|") + "'"
			} else {
				feature.properties.tags['lanes:backward:width'] = Number(document.getElementById("lanes:backward:width").value)
			}

		}
		if (document.getElementById("cycleway:lane:width").value != "") {
			if (document.getElementById("ftBikeLaneCheck").checked) {
				feature.properties.tags['cycleway:lane:width'] = document.getElementById("cycleway:lane:width").value + "'"
			} else {
				feature.properties.tags['cycleway:lane:width'] = Number(document.getElementById("cycleway:lane:width").value)
			}

		}

		if (document.getElementById("parking:both:width").value != "") {
			if (document.getElementById("ftParkingLaneRightWidthCheck").checked) {
				feature.properties.tags['parking:both:width'] = document.getElementById("parking:both:width").value + "'"
			} else {
				feature.properties.tags['parking:both:width'] = Number(document.getElementById("parking:both:width").value)
			}

		}


		feature.properties.tags['highway'] = document.getElementById("highway").value

		if (document.getElementById("name").value != "") {
			feature.properties.tags['name'] = document.getElementById("name").value
		}

		if (document.getElementById("ref").value != "") {
			feature.properties.tags['ref'] = document.getElementById("ref").value
		}

		if (document.getElementById("width:carriageway").value != "") {
			feature.properties.tags['width:carriageway'] = document.getElementById("width:carriageway").value
		}

	} else {
		tags = feature.properties.tags
		if (tags['cycleway:separation']=="parking_lane") {
			if (tags['oneway'] == 'yes') {
				tags['cycleway:right:traffic_mode:left'] = "parking"
			} else {
				tags['cycleway:right:traffic_mode:left'] = "parking"
				tags['cycleway:left:traffic_mode:left'] = "parking"
			}
			delete tags['cycleway:separation']
			console.log(tags)
		}

		if (tags['cycleway:left:separation:left']=="parking_lane") {
			tags['cycleway:left:traffic_mode:left'] = "parking"
			delete tags['cycleway:left:separation:left']
			console.log(tags)
		}

		if (tags['cycleway:right:separation:left']=="parking_lane") {
			tags['cycleway:left:traffic_mode:left'] = "parking"
			delete tags['cycleway:left:separation:left']
			console.log(tags)
		}

		if (Object.keys(feature.properties.tags).includes("cycleway:both")) {
			feature.properties.tags['cycleway'] = feature.properties.tags['cycleway:both']
			delete feature.properties.tags['cycleway:both']
		}

		if (Object.keys(feature.properties.tags).includes("parking:both")) {
			feature.properties.tags['parking:left'] = feature.properties.tags['parking:both']
			feature.properties.tags['parking:right'] = feature.properties.tags['parking:both']
			delete feature.properties.tags['parking:both']
		}

		if (Object.keys(feature.properties.tags).includes("parking:both:orientation")) {
			feature.properties.tags['parking:left:orientation'] = feature.properties.tags['parking:both:orientation']
			feature.properties.tags['parking:right:orientation'] = feature.properties.tags['parking:both:orientation']
			delete feature.properties.tags['parking:both:orientation']
		}

		if (Object.keys(feature.properties.tags).includes("turn:lanes") && Object.keys(feature.properties.tags).includes("oneway")) {
			if (feature.properties.tags['oneway']=="yes") {
				feature.properties.tags['turn:lanes:forward'] = feature.properties.tags['turn:lanes']
				delete feature.properties.tags['turn:lanes']
			}
		}

		if (Object.keys(feature.properties.tags).includes("busway:left")) {

				feature.properties.tags['bus:lanes:forward'] = 'designated'
				for (i=0; i<Number(feature.properties.tags['lanes:forward']); i++) {
	        feature.properties.tags['bus:lanes:forward'] += '|'
	      }
				delete feature.properties.tags['busway:left']

		}



		Object.keys(feature.properties.tags).forEach ( tag => {
			if (document.getElementById(tag)) {
				if (tag == "maxspeed") {
					document.getElementById(tag).value = String(feature.properties.tags[tag]).split(" ")[0]

					if (String(feature.properties.tags[tag]).split(" ")[1] == 'mph') {
							$('#mphCheck').is(':checked')==true
					}

				} else {
					// console.log(tag, feature.properties.tags[tag])
					// https://stackoverflow.com/a/3544927 (colons can create issues in id because : is a pseudo selector in jQuery)
					// $('#'+tag).val(feature.properties.tags[tag]).change()
					if (tag.includes('width') || tag.includes('lanes:forward:width') || tag.includes('lanes:backward:width')) {
						document.getElementById(tag).value = (String(feature.properties.tags[tag]).replaceAll("'", ''))
					} else {
						document.getElementById(tag).value = feature.properties.tags[tag]
					}
				}
			}


		})
	}


	if(Object.keys(feature.properties.tags).includes('name') == true) {
		streetName = feature.properties.tags['name']
	} else {
		if(Object.keys(feature.properties.tags).includes('ref') == true) {
			streetName = feature.properties.tags['ref']

		} else {
			streetName = feature.properties.tags['name'] = "Unnamed street"
		}
	}

	// console.log(JSON.stringify(feature))
	crossSectionInfo = generateCrossSectionTable(feature)
	// console.log(crossSectionInfo)
	offsetArray = crossSectionInfo['offsetArray']
	// console.log(offsetArray)
	html = "<center><div style='padding-top:5px;display:inline-block;background-color:#a9ccdb;border-left:7px solid red;border-right:7px solid blue'><div id='streetName' style='display:block;margin-bottom:20px;'>"+streetName+"</div>"+crossSectionInfo['html'] + "</div></center></div>"
	$('#content').html(html);


	widthPixels = $('.streetmix').width()
	pixelsPerInch = 6 * multiplier
	// console.log(widthPixels , pixelsPerInch)
	totalWidth = Math.floor(widthPixels / pixelsPerInch) +"' "+Math.floor(((widthPixels / pixelsPerInch)-(Math.floor(widthPixels / pixelsPerInch)))*12)+'"'
	// totalWidth=''
	// document.getElementById('width:carriageway').value = Math.round(widthPixels / pixelsPerInch) + "'"
	//feature.properties.tags['width:carriageway'] = document.getElementById('width:carriageway').value
	var tagString = ''
	// for (tag in Object.keys(feature.properties.tags)) {
	// 	tagString += tag + "=" + feature.properties.tags[tag]
	// }
	Object.keys(feature.properties.tags).forEach(function(key) {
    tagString += key + "=" + feature.properties.tags[key]+'\n';
    // ...
	});
	html = "<pre>" + tagString + "</pre>"
	$('#code').html(html);
	$('#streetName').html($('#streetName').text() + " (" + Math.round(widthPixels / pixelsPerInch) +"')");
	document.title = $('#streetName').text() + " - CrossSection+"




}



var offsetArray;

function getWayData(id) {
	$.get("https://www.openstreetmap.org/api/0.6/way/"+id+".json", function(osmDataAsJson) {
		feature = {'properties': {'tags': {}}}
		feature.properties.tags = osmDataAsJson['elements'][0]['tags']
		wayLineString = turf.lineString(feature)
		loadCrossSection(feature)

		loadWay(id)
		drawLanes(streetsAsGeojson)
	});
}



function loadWay(id) {
	if (typeof streetsAsGeojson == 'undefined'){
		// console.log('Querying OSM...')
	$.get('https://overpass-api.de/api/interpreter?data=[timeout:250][out:json];way(id:'+id+');out geom;', function(osmDataAsJson) {
		// console.log(osmDataAsJson)

		streetsAsGeojson = osmtogeojson(osmDataAsJson);
		// console.log(offsetArray)


		// console.log((((offsetArray.at(-1)/2)-offsetArray.at(-1))*12))
		// L.geoJson(turf.lineOffset(streetsAsGeojson['features'][0], (((offsetArray.at(-1)/2)-offsetArray.at(-1))*12), {units: 'inches'})).addTo(map)

		streetLayer = L.geoJson(streetsAsGeojson, {style: function(feature){ return {color:'yellow', dashArray:'30,10', opacity:0, interactive: false}}}).addTo(map);

		map.fitBounds(streetLayer.getBounds());
		// console.log(streetsAsGeojson)
		drawLanes(streetsAsGeojson)
		updateStats(streetStatsOrig)
		return streetsAsGeojson;
	});

}
}

function drawLanes(streetsAsGeojson) {

			map.removeLayer(lanesLayer)
			lanesLayer.clearLayers()
			lanesLayer = L.featureGroup().addTo(map);

			if (typeof streetsAsGeojson !== 'undefined') {
			for (i = 0; i < offsetArray.length; i++) {
				// console.log((((offsetArray.at(-1)/2)-offsetArray[i])*12))
				// console.log(streetsAsGeojson)
				L.geoJson(getLineOffset(streetsAsGeojson['features'][0], (((offsetArray.at(-1)/2)-offsetArray[i]+Number($('#centerlineOffset').val()))*12), {units: 'inches'}), {
					style: function(feature){
						if (i==0 ) {
							return {color:'red', interactive: false}
						} else if (i == offsetArray.length-1) {
							return {color:'blue', interactive: false}
						} else {
							return {color:'yellow', interactive: false}
						}
					}

			}).addTo(lanesLayer)
		}

		// console.log(streetsAsGeojson)
		map.removeLayer(laneMarkings);
			laneMarkings.clearLayers();
		streetsAsGeojson['features'].forEach((element) => drawLaneMarkingsFromFeature(element, Number($('#centerlineOffset').val())));
		map.addLayer(laneMarkings);

		// console.log('recalculating streetStats')
		clearStreetStats()
		calcStreetStats(streetsAsGeojson['features'][0])
		updateStats(streetStats)
	}

			lanesLayer.addTo(map);


}


function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    var items = location.search.substr(1).split("&");
    for (var index = 0; index < items.length; index++) {
        tmp = items[index].split("=");
        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
    }
    return result;
}



function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], {type: contentType});
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
		URL.revokeObjectURL(a.href)
}

function copyTextFunc(text) {
  // Get the text field
  // var copyText = document.getElementById("code");

  // Select the text field
  // copyText.select();
  // copyText.setSelectionRange(0, 99999); // For mobile devices

   // Copy the text inside the text field
  navigator.clipboard.writeText(text);

  // Alert the copied text
  alert("Copied the text:\n\n" + text);
}


var CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
subdomains: 'abcd',
maxZoom: 22
})


var cuyahoga = L.esri.tiledMapLayer({
		url: 'https://gis.cuyahogacounty.us/server/rest/services/IMAGERY/2022_Fall_Aerial/MapServer/',
		zoomOffset: -10,
		maxZoom: 21,
})


// create an object to hold layer names as you want them to appear in the basemap switcher list
let basemapControl = {
"Google Maps": hybridMutant,
"cuyahoga": cuyahoga,
// "OSM": openstreetmaps,
// "Stadia_AlidadeSmooth": Stadia_AlidadeSmooth,
// "Stadia_StamenTonerLite": Stadia_StamenTonerLite,
// "Stamen_toner_labels": Stamen_toner_labels,

}

// display the control (switcher list) on the map, by default in the top right corner
L.control.layers( basemapControl ).addTo( map )





function updateStats(streetStats) {
	console.log('recalculating streetStats')
  // 25% of this street has bike lanes.
  // 50% of this street has mixed lanes.
  // 25% of this street is without any safe bike space.
  bikelanes = (streetStats.primary_cyclelane+streetStats.secondary_cyclelane+streetStats.tertiary_cyclelane )
  mixedlanes = (streetStats.primary_sharedlane+streetStats.secondary_sharedlane+streetStats.tertiary_sharedlane)
  // mixed25lanes = (sha)
  totallanes = (streetStats.primary+streetStats.secondary+streetStats.tertiary+streetStats.total_residential_etc)
  nonelanes = totallanes-streetStats.total_residential_etc - (bikelanes + mixedlanes)

  bikelanesPct = ~~Math.round(bikelanes / totallanes*100)
  mixedlanesPct = (mixedlanes / totallanes*100)
  if (mixedlanesPct > 0 && mixedlanesPct < 1) {
    mixedlanesPct = '<1'
  } else {
    mixedlanesPct = ~~Math.round(mixedlanesPct)
  }
  mixed25lanesPct = ~~Math.round(streetStats.shared_25 / (totallanes)*100)
  mixed35lanesPct = ~~Math.round(streetStats.shared_35 / (totallanes)*100)
  nonelanesPct = ~~Math.round(nonelanes / totallanes*100)
  separatedPct = ~~Math.round(streetStats.total_separated_cycleway / totallanes*100)
  unseparatedPct = ~~Math.round((bikelanes-streetStats.total_separated_cycleway) / totallanes*100)
  resLanesPct = Math.round(streetStats.total_residential_etc / totallanes*100)
  if (resLanesPct == Infinity) {
    resLanesPct = 100
  }

  $('#stats').html(
    // resLanesPct + '% ('+Math.round(streetStats.total_residential_etc*100)/100+'mi) of this street is residential and presumed safe.<hr>'+
    // bikelanesPct + '% ('+Math.round(bikelanes*100)/100+'mi) of this street has mobility lanes. ('+
    // separatedPct + '% ('+Math.round(streetStats.total_separated_cycleway*100)/100+'mi) protected, '+
    // unseparatedPct + '% ('+Math.round((bikelanes - streetStats.total_separated_cycleway)*100)/100+'mi) unprotected)<br> '+
    // mixedlanesPct + '% ('+Math.round(mixedlanes*100)/100+'mi) of this street has mixed lanes. ('+
    // mixed25lanesPct + '% ('+Math.round(streetStats.shared_25*100)/100+'mi) &le;25mph, '+
    // mixed35lanesPct + '% ('+Math.round(streetStats.shared_35*100)/100+'mi) 30+)<br>'+
    // nonelanesPct + '% ('+Math.round(nonelanes*100)/100+'mi) of this street has no marked mobility space.<br>'+
    '<table class="table table-striped"><tr><td>Residential '+resLanesPct + '% ('+Math.round(streetStats.total_residential_etc*100)/100+'mi)</td><td></td><td>Residential '+resLanesPct + '% ('+Math.round(streetStats.total_residential_etc*100)/100+'mi)</td><td><a title="Down10 at English Wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-green_circle.svg"><img width="16" alt="Ski trail rating symbol-green circle" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Ski_trail_rating_symbol-green_circle.svg/32px-Ski_trail_rating_symbol-green_circle.svg.png"></a></td></tr>'+'<tr><td rowspan=5>Non-residential '+(100-resLanesPct) + '% ('+Math.round(totallanes*100)/100+'mi)</td><td>Separated '+bikelanesPct + '% ('+Math.round(bikelanes*100)/100+'mi)</td><td>Protected '+separatedPct + '% ('+Math.round(streetStats.total_separated_cycleway*100)/100+'mi)</td><td><a title="Down10 at English Wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-green_circle.svg"><img width="16" alt="Ski trail rating symbol-green circle" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Ski_trail_rating_symbol-green_circle.svg/32px-Ski_trail_rating_symbol-green_circle.svg.png"></a></td></tr>'+
    '<tr><td></td><td>Unprotected '+unseparatedPct + '% ('+Math.round((bikelanes - streetStats.total_separated_cycleway)*100)/100+'mi)</td><td><a title="Down10 at English Wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-blue_square.svg"><img width="16" alt="Ski trail rating symbol-blue square" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Ski_trail_rating_symbol-blue_square.svg/32px-Ski_trail_rating_symbol-blue_square.svg.png"></a></td></tr>'+
    '<tr><td>Mixed '+mixedlanesPct + '% ('+Math.round(mixedlanes*100)/100+'mi)<td>&le;25MPH '+mixed25lanesPct + '% ('+Math.round(streetStats.shared_25*100)/100+'mi)</td><td><a title="Down10 at en.wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-black_diamond.svg"><img width="16" alt="Ski trail rating symbol-black diamond" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Ski_trail_rating_symbol-black_diamond.svg/32px-Ski_trail_rating_symbol-black_diamond.svg.png"></a></td></tr>'+
    '<tr><td></td><td>30+MPH '+mixed35lanesPct + '% ('+Math.round(streetStats.shared_35*100)/100+'mi)</td><td><a title="Down10 at en.wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-black_diamond.svg"><img width="16" alt="Ski trail rating symbol-black diamond" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Ski_trail_rating_symbol-black_diamond.svg/32px-Ski_trail_rating_symbol-black_diamond.svg.png"></a></td></tr>'+
    '<tr><td>Unmarked '+nonelanesPct + '% ('+Math.round(nonelanes*100)/100+'mi)</td><td>Unmarked '+nonelanesPct + '% ('+Math.round(nonelanes*100)/100+'mi)</td><td><a title="Down10 at en.wikipedia, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ski_trail_rating_symbol-black_diamond.svg"><img width="16" alt="Ski trail rating symbol-black diamond" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Ski_trail_rating_symbol-black_diamond.svg/32px-Ski_trail_rating_symbol-black_diamond.svg.png"></a></td></tr>'+
    '<table>'

  );
}

var streetStats = new Proxy(streetStatsOrig, {
  set: function (target, key, value) {
      // console.log(`${key} set to ${value}`);
      target[key] = value;

      updateStats(streetStatsOrig)
			// updateStats(calcStreetStats(streetsAsGeojson['features'][0]))
      // for (var key in streetStats){
      //     console.log( key + ": " + streetStats[key]);
      // }
      return true;
  }
});

</script>

</body>
</html>
